<!doctype html>
<html>
<head>
	<title>Demo </title>
	<style>
	body { width: max-content; }
	.grid {
		display: inline-block;
	}
	.row {
		margin: 0;
		height: 7px;
	}
	.cell {
		border-top: 7px solid #ddd;
		width: 7px;
		display: inline-block;
		vertical-align: top;
	}
	</style>
	<script src = "https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type = "text/javascript"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.6/xlsx.full.min.js"></script>
	<script>
	
	</script>
</head>
<body>
<div>
	<input type="button" id="viewfile" value="Export To Table" onclick="ExportToTable()" />
</div>
<div class="grid"></div>
	<script src = "plugins/grid.js"></script>
<script>
(function() {
    var grid = new Grid({
        rows: 1000,
        cols: 1000,
        render: {
            placeholder: ".grid"
        }
    });
    <!-- grid.getCellAt(2, 1).$el.css('background', 'red'); -->
}());
</script>
<!-- uncomment the next line here and in xlsxworker.js for encoding support -->
<script src="plugins/xlsx/dist/cpexcel.js"></script>
<script src="plugins/xlsx/shim.js"></script>
<script src="plugins/xlsx/jszip.js"></script>
<script src="plugins/xlsx/xlsx.js"></script>

<script>
/*jshint browser:true */
/* eslint-env browser */
/*global Uint8Array, console */
/*global XLSX */
var X = XLSX;
var XW = {
	/* worker message */
	msg: 'xlsx',
	/* worker scripts */
	worker: './xlsxworker.js'
};

var global_wb;

var process_wb = (function() {
	<!-- var OUT = document.getElementById('out'); -->
	<!-- var HTMLOUT = document.getElementById('htmlout'); -->

	<!-- var get_format = (function() { -->
		<!-- var radios = document.getElementsByName( "format" ); -->
		<!-- return function() { -->
			<!-- for(var i = 0; i < radios.length; ++i) if(radios[i].checked || radios.length === 1) return radios[i].value; -->
		<!-- }; -->
	<!-- })(); -->

	var to_json = function to_json(workbook) {
		var result = {};
		workbook.SheetNames.forEach(function(sheetName) {
			var roa = X.utils.sheet_to_json(workbook.Sheets[sheetName], {header:1});
			if(roa.length) result[sheetName] = roa;
		});
		return JSON.stringify(result, 2, 2);
	};

	<!-- var to_csv = function to_csv(workbook) { -->
		<!-- var result = []; -->
		<!-- workbook.SheetNames.forEach(function(sheetName) { -->
			<!-- var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]); -->
			<!-- if(csv.length){ -->
				<!-- result.push("SHEET: " + sheetName); -->
				<!-- result.push(""); -->
				<!-- result.push(csv); -->
			<!-- } -->
		<!-- }); -->
		<!-- return result.join("\n"); -->
	<!-- }; -->

	<!-- var to_fmla = function to_fmla(workbook) { -->
		<!-- var result = []; -->
		<!-- workbook.SheetNames.forEach(function(sheetName) { -->
			<!-- var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]); -->
			<!-- if(formulae.length){ -->
				<!-- result.push("SHEET: " + sheetName); -->
				<!-- result.push(""); -->
				<!-- result.push(formulae.join("\n")); -->
			<!-- } -->
		<!-- }); -->
		<!-- return result.join("\n"); -->
	<!-- }; -->

	<!-- var to_html = function to_html(workbook) { -->
		<!-- HTMLOUT.innerHTML = ""; -->
		<!-- workbook.SheetNames.forEach(function(sheetName) { -->
			<!-- var htmlstr = X.write(workbook, {sheet:sheetName, type:'binary', bookType:'html'}); -->
			<!-- HTMLOUT.innerHTML += htmlstr; -->
		<!-- }); -->
		<!-- return ""; -->
	<!-- }; -->

	return function process_wb(wb) {
		///Draw HERE
		global_wb = wb;
		var output = "";
		output = to_json(wb);
		console.log("Output", output);
		<!-- if(OUT.innerText === undefined) OUT.textContent = output; -->
		<!-- else OUT.innerText = output; -->
		<!-- if(typeof console !== 'undefined') console.log("output", new Date()); -->
	};
})();

var setfmt = window.setfmt = function setfmt() { if(global_wb) process_wb(global_wb); };

var b64it = window.b64it = (function() {
	var tarea = document.getElementById('b64data');
	return function b64it() {
		if(typeof console !== 'undefined') console.log("onload", new Date());
		var wb = X.read(tarea.value, {type:'base64', WTF:false});
		process_wb(wb);
	};
})();

var do_file_ = (function() {
	var use_worker = typeof Worker !== 'undefined';
	var xw = function xw(data, cb) {
		var worker = new Worker(XW.worker);
		worker.onmessage = function(e) {
			switch(e.data.t) {
				case 'ready': break;
				case 'e': console.error(e.data.d); break;
				case XW.msg: cb(JSON.parse(e.data.d)); break;
			}
		};
		worker.postMessage({d:data,b:rABS?'binary':'array'});
	};

	return function do_file_(file) {
		rABS = true;
		var f = file;
		var reader = new FileReader();
		reader.onload = function(e) {
			if(typeof console !== 'undefined') console.log("onload", new Date());
			var data = e.target.result;
			process_wb(X.read(data, {type: rABS ? 'binary' : 'array'}));
		};
		reader.readAsBinaryString(f);
	};
})();

function ExportToTable() {
	var request = new XMLHttpRequest();

	request.responseType = "blob";
	request.onreadystatechange = (e) => {
		if (request.readyState !== 4) {
			return;
		}
		if (request.status === 200) {
			console.log('success', request);
		} else {
			console.warn('error');
		}
	};

	request.onload = function(oEvent) {
		var blob = request.response;
		// ...
		<!-- do_file_(blob); -->
		var reader = new FileReader();
		reader.onload = function(e) {
			if(typeof console !== 'undefined') console.log("onload", new Date());
			var data = e.target.result;
			process_wb(X.read(data, {type: 'binary'}));
		};
		reader.readAsBinaryString(blob);
	};
	request.open('GET', "data/28.xlsx");
	request.send();
};

</script>
<script type="text/javascript">
/* eslint no-use-before-define:0 */
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-36810333-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>